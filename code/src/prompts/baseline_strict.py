"""
형식 제약 강화 베이스라인 프롬프트

전문가 조언 기반:
- System 메시지에 명시적 금지 규칙
- 원문 외 한 글자도 수정 금지
- 숫자/단위/고유명사/띄어쓰기 유지
- 메타데이터 출력 금지
"""

from .base import BasePrompt


class BaselineStrictPrompt(BasePrompt):
    """
    형식 제약 강화 프롬프트

    메타데이터 출현, 텍스트 반복, 불필요한 수정을 방지하기 위해
    System 메시지에 구체적이고 강력한 제약 규칙 추가
    """

    @property
    def name(self) -> str:
        """프롬프트 이름 반환"""
        return "baseline_strict"

    def system_message(self) -> str:
        """
        System 메시지 반환

        명시적 금지 규칙:
        - 타겟 오류 외 원문 보존
        - 숫자/단위 유지
        - 메타데이터 금지
        """
        return """당신은 한국어 문법 교정 전문가입니다.

# 절대 규칙

1. 원문 보존
   - 오류가 있는 부분만 교정
   - 그 외 부분은 한 글자도 바꾸지 말 것
   - 원문의 어순, 표현 방식 유지

2. 숫자 및 단위 유지
   - "10만명" → "10만 명" 변경 금지
   - "160cm~170cm" → "160~170cm" 변경 금지
   - 원문 그대로 유지

3. 고유명사 및 띄어쓰기 유지
   - 인명, 지명, 기관명 변경 금지
   - 원문의 띄어쓰기 패턴 유지
   - 불필요한 띄어쓰기 추가 금지

4. 출력 형식 엄수
   - 교정된 문장만 출력
   - 설명 문구 절대 금지
   - 다음 표현 사용 금지:
     * ※, 지시사항, 설명, 참고
     * 원문:, 교정:, 수정:
     * <원문>, <교정>
     * ---, ###, 콜론(:) 사용 금지

5. 반복 금지
   - 같은 문장을 두 번 이상 출력 금지
   - 문장은 정확히 한 번만

6. 교정 범위
   - 맞춤법, 띄어쓰기, 문장 부호, 문법 오류만 수정
   - 문체, 뉘앙스는 변경하지 말 것"""

    def format_user_message(self, text: str) -> str:
        """
        사용자 메시지 포맷팅

        Args:
            text: 교정할 원문 텍스트

        Returns:
            str: 포맷팅된 프롬프트
        """
        template = """# 교정 요청

다음 문장을 교정하세요. 위 절대 규칙을 엄수하십시오.

원문:
{text}

교정 문장:"""

        return template.format(text=text)
