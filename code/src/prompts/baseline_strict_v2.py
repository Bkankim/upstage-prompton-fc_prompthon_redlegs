"""
형식 제약 강화 베이스라인 v2

피드백 기반 전면 개선:
- 규칙 완화 및 충돌 제거
- 콜론 금지 범위 한정
- 사용자 메시지 콜론 제거
- 긍정적 지시 추가
"""

from .base import BasePrompt


class BaselineStrictV2Prompt(BasePrompt):
    """
    형식 제약 강화 프롬프트 v2

    외부 피드백 기반 개선:
    - 과도한 제약 완화
    - 규칙 간 충돌 제거
    - 프롬프트 일관성 확보
    - 긍정적 지시 중심
    """

    @property
    def name(self) -> str:
        """프롬프트 이름 반환"""
        return "baseline_strict_v2"

    def system_message(self) -> str:
        """
        System 메시지 반환

        개선 사항:
        1. 규칙 6개 → 4개로 축소
        2. "금지" 대신 "해야 할 것" 표현
        3. 충돌하는 규칙 제거
        4. 콜론 금지 범위 한정
        """
        return """당신은 한국어 문법 교정 전문가입니다.

# 교정 원칙

1. 최소 편집
   - 타깃 오류만 정확히 교정
   - 오류 외 부분은 가급적 유지
   - 필요한 경우(띄어쓰기, 조사, 문장부호 오류)는 수정 허용

2. 교정 범위
   - 맞춤법, 띄어쓰기, 문장부호, 문법 오류 교정
   - 명백한 오류일 때만 수정
   - 문체, 뉘앙스는 변경하지 않음

3. 출력 형식
   - 교정된 문장만 한 줄로 출력
   - 설명 없음, 줄바꿈 없음
   - 메타데이터 레이블 사용 금지:
     * "원문:", "교정:", "수정:"
     * "※", "<원문>", "<교정>"
     * "지시사항", "설명", "참고"
   - 시간/비율 표기(7:3, 19:30)는 허용됨

4. 품질 기준
   - 정확성: 타깃 오류를 정확히 교정
   - 간결성: 한 문장으로 출력
   - 자연스러움: 원문의 자연스러운 흐름 유지"""

    def format_user_message(self, text: str) -> str:
        """
        사용자 메시지 포맷팅

        개선 사항:
        - 콜론 제거 (System 메시지와 일관성)
        - 긍정적 지시 추가
        - 명확한 출력 요구

        Args:
            text: 교정할 원문 텍스트

        Returns:
            str: 포맷팅된 프롬프트
        """
        template = """다음 문장을 위 원칙에 따라 한 줄로 교정하세요.

{text}"""

        return template.format(text=text)
