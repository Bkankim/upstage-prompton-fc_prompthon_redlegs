"""
Few-shot 강화 프롬프트 (v3 improved)

Phase 5 심층 분석 기반 개선:
- 13개 → 10개로 축소
- 취약 유형 예시 추가 (문법-어미, 표현다듬기, 단위, 사이시옷)
- 오류 위치 명확 + 최소 편집 원칙
"""

from .base import BasePrompt


class FewShotV3ImprovedPrompt(BasePrompt):
    """
    Few-shot 학습 강화 프롬프트 v3 improved

    개선 사항:
    - 취약 유형 우선 배치 (문법-어미, 표현다듬기, 단위, 사이시옷)
    - 예시 축소 (13개 → 10개)
    - 모든 예시는 명확한 오류 + 최소 편집
    """

    @property
    def name(self) -> str:
        """프롬프트 이름 반환"""
        return "fewshot_v3_improved"

    def system_message(self) -> str:
        """시스템 메시지 반환 (사용하지 않음)"""
        return ""

    def format_user_message(self, text: str) -> str:
        """
        사용자 메시지 포맷팅

        Args:
            text: 교정할 원문 텍스트

        Returns:
            str: Few-shot 예시가 포함된 프롬프트
        """
        template = """# 지시
- 다음 규칙에 따라 원문을 교정하세요.
- 맞춤법, 띄어쓰기, 문장 부호, 문법을 자연스럽게 교정합니다.
- 어떤 경우에도 설명이나 부가적인 내용은 포함하지 않습니다.
- 오직 교정된 문장만 출력합니다.

# 예시

## 문법-어미 (잘못된 준말)
<원문>
우리 가족은 언제나 웃음이 끊이지 않는 화목한 분위기였다. 비록 살림이 넉넉치 않아도 우리는 결코 불행하지 않았다.
<교정>
우리 가족은 언제나 웃음이 끊이지 않는 화목한 분위기였다. 비록 살림이 넉넉지 않아도 우리는 결코 불행하지 않았다.

## 표현다듬기
<원문>
이 제품은 정말 최고의 성능을 발휘하는 아주 좋은 제품입니다.
<교정>
이 제품은 최고의 성능을 발휘합니다.

## 단위
<원문>
산림청은 2000년 강원도 산불이 발생한 이후 생태계의 변화를 추적 조사했는데, 그 결과를 참고할 만하다. 당시엔 산불로 잠실 82개에 달하는 2만3794ha가 불탔다.
<교정>
산림청은 2000년 강원도 산불 발생 이후 생태계 변화를 추적 조사했는데, 그 결과를 참고할 만하다. 당시 산불로 잠실 82개 면적에 달하는 2만3794ha가 불탔다.

## 사이시옷
<원문>
입국장 문을 나서자마자 휴대폰을 꺼냈다. 연결 소리가 몇 번 울리다 딸아이가 받았다.
<교정>
입국장 문을 나서자마자 휴대폰을 꺼냈다. 연결 소리가 몇 번 울리다 딸애가 받았다.

## 비문
<원문>
그가 케네디 정책이라는 점을 연관이 부각해 당위성을 강조하려는 분석이 제기된다.
<교정>
그가 케네디 정책이라는 점을 부각해 당위성을 강조하려는 분석이 제기된다.

## 문장부호
<원문>
영국의 요구가 비현실적이라는 지적이 나왔다..
<교정>
영국의 요구가 비현실적이라는 지적이 나왔다.

## 능동피동
<원문>
사람들의 대부분이 벽에 부딪쳐 결국은 변호사를 찾게 된다.
<교정>
사람들의 대부분이 벽에 부딪혀 결국은 변호사를 찾게 된다.

## 누락
<원문>
작년 국내 자동차 판매량(약 167만대) SUV(약 92만대) 비중이 절반이 넘었다.
<교정>
작년 국내 자동차 판매량(약 167만대) 중 SUV(약 92만대) 비중이 절반이 넘었다.

## 중복
<원문>
예전에는 직접 사람이 가위나 날카로운 도구를 이용해 직접 손으로 하던 작업이다.
<교정>
예전에는 사람이 가위나 날카로운 도구를 이용해 직접 손으로 하던 작업이다.

## 외래어
<원문>
교관 메뉴얼도 학습한다.
<교정>
교관 매뉴얼도 학습한다.

# 교정할 문장
<원문>
{text}
<교정>"""

        return template.format(text=text)
