# Baseline + 3 Examples 실패 분석 보고서

**날짜**: 2025-10-24
**제출 파일**: `submission_baseline_plus_3examples_test.csv`
**LB 성적**: 27.6596 (Public) / 9.7744 (Private)
**비교 대상**: `submission_baseline_test_clean.csv` (34.0426 / 13.4454)
**성능 하락**: -6.38%p (Public) / -3.68%p (Private)

---

## 실행 요약

### 기대
- Train 성능: 34.69% (기존 32.24% +2.45%p) 향상
- 기대 LB: 35-37%

### 결과
- Public LB: 27.66% (-6.38%p, **18.7% 하락**)
- Private LB: 9.77% (-3.68%p, **27.4% 하락**)

### 근본 원인
**Few-shot 예시 추가가 오히려 모델 성능을 저하시킴**

---

## 세부 분석

### 1. 충격적 발견: Baseline의 "운 좋은 버그"

#### grm260797 케이스 상세

```
[원문] (353자)
추기경회의의 결과 자체가 중요한 정치적 메시지를 담기도 한다. 1995년 베네딕토 15세의 후임자를 뽑는 추기경회의에서...

[Baseline 교정] (1460자 - 4배 폭발!)
추기경 회의의 결과... (교정 1차)
[수정 보완]
추기경 회의의 결과... (교정 2차 - 날짜 수정)
[최종 교정본 - 요청사항 준수]
추기경 회의의 결과... (교정 3차)
최종 출력:
추기경 회의의 결과... (교정 4차)

[Plus3 교정] (353자 - 원문 유지)
추기경회의의 결과... (띄어쓰기 미교정)
```

**발견:**
- Baseline은 메타데이터를 포함해 동일 문장을 4번 반복 출력
- RuleChecklist postprocessor가 제대로 제거하지 못함
- 평가 시 4번 중 일부와 매칭되어 높은 점수 획득
- **Baseline의 34.04%는 "버그 덕분"**

#### Baseline 메타데이터 현황
- 메타데이터 포함 케이스: 5개 (4.5%)
- 주요 패턴: "# 교정", "# 최종 출력", "[수정 보완]", "최종 출력:"
- grm260797, grm780698, grm652075, grm976480 등

---

### 2. Plus3의 치명적 문제

#### 2.1 첫 문장만 출력 문제 (3개 케이스)

**원인**: Few-shot 예시가 모두 짧은 단일 문장

| ID | 원문 문장 수 | 교정 문장 수 | 길이 변화 |
|---|---|---|---|
| grm507534 | 5문장 (231자) | 1문장 (52자) | **-77% 삭제** |
| grm750415 | 3문장 (178자) | 1문장 (54자) | **-70% 삭제** |
| grm807505 | 3문장 (245자) | 1문장 (48자) | **-80% 삭제** |

**예시:**
```
[원문] grm807505
바이든 행정부 출범 이래 대만의 독자 핵무장에 대한 국민적 관심과 지지가 증가 추세다.
2017년 중국의 제6차 핵실험 이후 주로 보수적 시민단체들에 의해 제기되기 시작한 핵무장 담론은...
(3문장, 245자)

[Plus3 교정]
바이든 행정부 출범 이래 대만의 독자 핵무장에 대한 국민적 관심과 지지가 증가 추세다.
(1문장만, 48자)
```

#### 2.2 띄어쓰기 교정 부족 (다수 케이스)

**비교 샘플:**

| ID | 오류 | Baseline | Plus3 |
|---|---|---|---|
| grm924197 | 받아봐야겠다 | 받아 **봐야**겠다 ✅ | 받아**봐야**겠다 ❌ |
| grm381632 | 의자체조 | 의자 **체조** ✅ | 의자**체조** ❌ |
| grm260797 | 추기경회의 | 추기경 **회의** ✅ | 추기경**회의** ❌ |

**원인**: Few-shot 예시에 띄어쓰기 오류가 거의 없음

#### 2.3 문장부호 교정 부족

| ID | 오류 | Baseline | Plus3 |
|---|---|---|---|
| grm381632 | 동아일보 | 《동아일보》 ✅ | 동아일보 ❌ |
| grm302361 | 이란·시리아 | 이란-시리아 | 이란·시리아 (유지) |

#### 2.4 사실 오류 생성

**grm781546:**
- 원문: "함경도 청진"
- Baseline: "함경도 청진" (유지)
- Plus3: "**함경남도** 청진" (사실 오류! 청진은 함경**북**도)

---

### 3. 통계 요약

#### 전체 비교 (110개 케이스)

| 항목 | Baseline | Plus3 | 차이 |
|---|---|---|---|
| 원문 유지 비율 | 7개 (6.4%) | 10개 (9.1%) | +3개 |
| 메타데이터 포함 | 5개 (4.5%) | 1개 (0.9%) | -4개 (개선) |
| 길이 극단 감소 (50% 이하) | 0개 | 3개 | +3개 |
| 문장 수 감소 (2개 이상) | 0개 | 3개 | +3개 |

#### 변경 케이스 분석 (44개, 40%)

| 길이 변화 | 케이스 수 | 설명 |
|---|---|---|
| -1000자 이상 | 1개 | grm260797 (메타데이터 반복) |
| -100자 이상 | 4개 | 첫 문장만 출력 |
| -10 ~ +10자 | 34개 | 일반 교정 차이 |
| +10자 이상 | 5개 | 일부 보완 |

---

## 근본 원인: Few-shot 설계 오류

### 사용한 4개 예시

```python
1. 맞춤법
<원문>
오늘 날씨가 않좋은데, 김치찌게 먹으러 갈려고.
<교정>
오늘 날씨가 안 좋은데, 김치찌개 먹으러 가려고.

2. 조사 오류
<원문>
그는 삼성전자의 제안을 탐탁치 않게 여겼다.
<교정>
그는 삼성전자의 제안을 탐탁지 않게 여겼다.

3. 사이시옷
<원문>
그녀는 개나리꽃길을 따라 천천히 걸어갔다.
<교정>
그녀는 개나리꽃 길을 따라 천천히 걸어갔다.

4. 표현 다듬기
<원문>
이 제품은 정말 최고의 성능을 발휘하는 아주 좋은 제품입니다.
<교정>
이 제품은 최고의 성능을 발휘하는 좋은 제품입니다.
```

### 문제점

| 문제 | 영향 | 결과 |
|---|---|---|
| **모두 짧은 단일 문장** | 긴 문장 처리 능력 저하 | 첫 문장만 출력 (3개 케이스) |
| **띄어쓰기 오류 거의 없음** | 띄어쓰기 교정 소홀 | 다수 케이스에서 띄어쓰기 미교정 |
| **문장부호 오류 없음** | 문장부호 교정 소홀 | 겹낫표, 하이픈 등 미교정 |
| **단순 맞춤법 중심** | 복잡한 문법 능력 저하 | 어휘, 조사 교정 미흡 |
| **4개 예시만** | 다양성 부족 | 특정 패턴에 편향 |

---

## Baseline vs Plus3 성능 비교

### Baseline (34.04%)의 특징

**강점:**
- 공격적 교정 (많이 바꿈)
- 띄어쓰기, 문장부호 적극 교정
- 메타데이터 반복으로 인한 운 (5개 케이스)

**약점:**
- 메타데이터 오염 (5개 케이스, 4.5%)
- 길이 폭발 (일부 케이스)
- 일관성 부족

### Plus3 (27.66%)의 특징

**강점:**
- 메타데이터 감소 (1개만, 0.9%)
- 일부 케이스에서 더 자연스러운 교정

**약점 (치명적):**
- 보수적 교정 (덜 바꿈) → False Negative 증가
- 긴 문장 처리 실패 (3개 케이스)
- 띄어쓰기 교정 소홀 (다수)
- 문장부호 교정 소홀
- 사실 오류 생성 (1개)

---

## Recall 관점 분석

### Recall 공식
```
Recall = TP / (TP + FP + FN) × 100
```

### Plus3의 문제
- **False Negative (FN) 증가**: 띄어쓰기, 문장부호 등을 놓침
- **True Positive (TP) 감소**: 첫 문장만 출력으로 교정 기회 상실

### Baseline의 우위
- 공격적 교정으로 FN 감소
- 메타데이터 반복으로 TP 증가 (운 좋게)
- 일부 오류 있어도 전체적으로 유리

---

## 교훈

### 1. Few-shot은 양날의 검
- **장점**: 특정 패턴 강화
- **단점**: 다른 패턴 약화, 모델 편향

### 2. 예시 설계의 중요성
- 길이 다양성 필요 (짧은/긴 문장)
- 오류 유형 다양성 필요 (띄어쓰기, 문장부호 등)
- 복잡도 다양성 필요 (단순/복잡 문법)

### 3. Train 성능 ≠ Test 성능
- Train에서 +2.45%p 향상
- Test에서 -6.38%p 하락
- **과적합 발생**

### 4. Zero-shot vs Few-shot
- Baseline (1개 예시): 34.04%
- Plus3 (4개 예시): 27.66%
- **더 많은 예시 ≠ 더 좋은 성능**

### 5. 메타데이터 후처리의 중요성
- RuleChecklist도 완벽하지 않음
- Baseline의 5개 케이스에서 메타데이터 잔존
- 더 강력한 후처리 필요

---

## 다음 전략

### 즉시 실행

1. **Zero-shot 시도**
   - 예시 없이 시스템 프롬프트만 사용
   - 가설: 예시가 오히려 방해할 수 있음

2. **Baseline 재검증**
   - Baseline의 34.04%가 재현 가능한지 확인
   - 메타데이터 후처리 강화

3. **백업 전략**
   - baseline_test_clean.csv를 안전하게 보관
   - 실험 실패 시 즉시 재제출 가능하도록

### 중기 전략

4. **Few-shot 재설계 (조건부)**
   - 긴 문장 포함 (3문장 이상)
   - 띄어쓰기 오류 포함
   - 문장부호 오류 포함
   - 10개 이상의 다양한 예시

5. **시스템 프롬프트 강화**
   - 출력 형식 제약 명시
   - 교정 범위 명시 (모든 오류 교정)
   - 메타데이터 출력 금지 강조

6. **후처리 강화**
   - EnhancedPostprocessor 수정
   - 메타데이터 제거 강화
   - 길이 가드 구현 (60% 이하 방지)

---

## 참고 자료

- 비교 파일: `outputs/analysis/baseline_vs_plus3_comparison.csv`
- 프롬프트: `code/src/prompts/baseline_plus_3examples.py`
- 제출 파일 (실패): `outputs/submissions/test/submission_baseline_plus_3examples_test.csv`
- 제출 파일 (성공): `outputs/submissions/test/submission_baseline_test_clean.csv`

---

**작성일**: 2025-10-24
**분석자**: 실험 담당자
**상태**: 완료
